"use strict";var E=Object.create;var m=Object.defineProperty;var b=Object.getOwnPropertyDescriptor;var y=Object.getOwnPropertyNames;var R=Object.getPrototypeOf,A=Object.prototype.hasOwnProperty;var $=(e,n)=>{for(var r in n)m(e,r,{get:n[r],enumerable:!0})},P=(e,n,r,o)=>{if(n&&typeof n=="object"||typeof n=="function")for(let i of y(n))!A.call(e,i)&&i!==r&&m(e,i,{get:()=>n[i],enumerable:!(o=b(n,i))||o.enumerable});return e};var u=(e,n,r)=>(r=e!=null?E(R(e)):{},P(n||!e||!e.__esModule?m(r,"default",{value:e,enumerable:!0}):r,e)),T=e=>P(m({},"__esModule",{value:!0}),e);var H={};$(H,{activate:()=>k,deactivate:()=>j});module.exports=T(H);var s=u(require("vscode")),p=u(require("child_process")),v=u(require("path")),c=u(require("fs"));var d=[],t,w=!1,S={embedding:"C:\\Users\\marku\\Documents\\GitHub\\artqcid\\ai-projects\\embedding-server-misc",rag:"C:\\Users\\marku\\Documents\\GitHub\\artqcid\\ai-projects\\rag-server-misc",llama:"C:\\Users\\marku\\.continue\\llama-vscode-autostart.ps1",mcp:"C:\\Users\\marku\\Documents\\GitHub\\artqcid\\ai-projects\\mcp-server-misc"},h={llama:8080,embedding:8001,rag:8002,mcp:8003};function l(){let e=s.workspace.getConfiguration("juce-server-autostart");return{embedding:e.get("embeddingServerPath",S.embedding),rag:e.get("ragServerPath",S.rag),llama:e.get("llamaScriptPath",S.llama),mcp:e.get("mcpServerPath",S.mcp)}}function k(e){t=s.window.createOutputChannel("JUCE Server Autostart"),e.subscriptions.push(t),t.appendLine("[INFO] ===== JUCE Server Autostart Extension aktiviert ====="),t.show(!0);let n=s.commands.registerCommand("serverAutostart.startServers",()=>{L()}),r=s.commands.registerCommand("serverAutostart.stopServers",()=>{C()}),o=s.commands.registerCommand("serverAutostart.showStatus",()=>{G()});e.subscriptions.push(n,r,o);let i=s.workspace.getConfiguration("juce-server-autostart").get("autoStartDelay",2e3);t.appendLine(`[INFO] Starte alle Server beim Extension-Startup (Verz\xF6gerung: ${i}ms)...`),setTimeout(()=>L(),i)}function L(){if(w){t.appendLine("[WARN] Server sind bereits gestartet"),s.window.showWarningMessage("Server sind bereits gestartet. Verwende Stop vor Start.");return}if(t.appendLine("[INFO] ===== Starte alle Server ====="),s.window.showInformationMessage("Starte AI-Server..."),!N()){s.window.showErrorMessage("Ein oder mehrere Server-Pfade sind nicht konfiguriert!");return}t.appendLine("[INFO] Startup-Sequenz: Llama \u2192 Embedding \u2192 RAG \u2192 MCP"),F(),setTimeout(()=>{I()},3e3),setTimeout(()=>{x()},8e3),setTimeout(()=>{M(),t.appendLine("[OK] ===== Alle Server gestartet ====="),s.window.showInformationMessage("Alle AI-Server wurden erfolgreich gestartet!")},12e3),w=!0}function N(){let e=l(),n=!0;return c.existsSync(e.llama)||(t.appendLine(`[ERROR] Llama Script nicht gefunden: ${e.llama}`),n=!1),c.existsSync(e.embedding)||(t.appendLine(`[ERROR] Embedding-Server Pfad nicht gefunden: ${e.embedding}`),n=!1),c.existsSync(e.rag)||(t.appendLine(`[ERROR] RAG-Server Pfad nicht gefunden: ${e.rag}`),n=!1),c.existsSync(e.mcp)||(t.appendLine(`[ERROR] MCP-Server Pfad nicht gefunden: ${e.mcp}`),n=!1),n}function F(){let e=l();t.appendLine("[INFO] Starte Llama-Server auf Port 8080...");let n=s.window.createTerminal({name:"Llama Server",hideFromUser:!1});d.push(n),n.show();let r=`powershell -NoProfile -ExecutionPolicy Bypass -File "${e.llama}"`;t.appendLine(`[CMD] ${r}`),n.sendText(r,!0),setTimeout(()=>{f("Llama",h.llama)},5e3)}async function f(e,n,r=10){return new Promise(o=>{let i=0,g=()=>{let O=require("net"),a=new O.Socket;a.setTimeout(1e3),a.once("connect",()=>{a.destroy(),t.appendLine(`[OK] ${e} ist verf\xFCgbar (Port ${n})`),o(!0)}),a.once("timeout",()=>{a.destroy(),i++,i<r?setTimeout(g,1e3):(t.appendLine(`[WARN] ${e} hat nicht geantwortet nach ${r*1e3}ms`),o(!1))}),a.once("error",()=>{a.destroy(),i++,i<r?setTimeout(g,1e3):(t.appendLine(`[WARN] ${e} konnte nicht erreicht werden (Port ${n})`),o(!1))}),a.connect({port:n,host:"127.0.0.1"})};g()})}function I(){let e=l();t.appendLine(`[INFO] Starte Embedding-Server auf Port 8001: ${e.embedding}`);let n=v.join(e.embedding,"start.ps1");if(!c.existsSync(n)){t.appendLine(`[ERROR] start.ps1 nicht gefunden: ${n}`),s.window.showErrorMessage("Embedding Server start.ps1 nicht gefunden");return}let r=s.window.createTerminal({name:"Embedding Server",hideFromUser:!1});d.push(r),r.show();let o=`pwsh -NoProfile -ExecutionPolicy Bypass -File "${n}"`;t.appendLine(`[CMD] ${o}`),r.sendText(o,!0),setTimeout(()=>{f("Embedding",h.embedding)},3e3)}function x(){let e=l();t.appendLine(`[INFO] Starte RAG-Server auf Port 8002: ${e.rag}`);let n=v.join(e.rag,"start.ps1");if(!c.existsSync(n)){t.appendLine(`[ERROR] start.ps1 nicht gefunden: ${n}`),s.window.showErrorMessage("RAG Server start.ps1 nicht gefunden");return}let r=s.window.createTerminal({name:"RAG Server",hideFromUser:!1});d.push(r),r.show();let o=`pwsh -NoProfile -ExecutionPolicy Bypass -File "${n}"`;t.appendLine(`[CMD] ${o}`),r.sendText(o,!0),setTimeout(()=>{f("RAG",h.rag)},5e3)}function M(){let e=l();t.appendLine(`[INFO] Starte MCP-Server (SSE) auf Port 8003: ${e.mcp}`);let n=v.join(e.mcp,"start-sse.ps1");if(!c.existsSync(n)){t.appendLine(`[ERROR] start-sse.ps1 nicht gefunden: ${n}`),s.window.showErrorMessage("MCP Server start-sse.ps1 nicht gefunden");return}let r=s.window.createTerminal({name:"MCP Server",hideFromUser:!1});d.push(r),r.show();let o=`pwsh -NoProfile -ExecutionPolicy Bypass -File "${n}"`;t.appendLine(`[CMD] ${o}`),r.sendText(o,!0),setTimeout(()=>{f("MCP",h.mcp)},3e3)}function C(){t.appendLine("[INFO] ===== Stoppe alle Server ====="),s.window.showInformationMessage("Stoppe alle Server..."),d.forEach(n=>{t.appendLine(`[INFO] Schlie\xDFe Terminal: ${n.name}`),n.dispose()}),d.length=0,[{name:"RAG Server + Qdrant",cmd:"Get-Process python -ErrorAction SilentlyContinue | Where-Object { $_.CommandLine -like '*rag*' } | Stop-Process -Force; Get-Process qdrant -ErrorAction SilentlyContinue | Stop-Process -Force"},{name:"Embedding Server",cmd:"Get-Process python -ErrorAction SilentlyContinue | Where-Object { $_.CommandLine -like '*embedding_server*' } | Stop-Process -Force"},{name:"Llama-Server",cmd:"Get-Process llama-server -ErrorAction SilentlyContinue | Stop-Process -Force"}].forEach(({name:n,cmd:r})=>{try{p.execSync(`powershell -NoProfile -Command "${r}"`,{windowsHide:!0}),t.appendLine(`[OK] ${n} gestoppt`)}catch{t.appendLine(`[INFO] ${n} nicht aktiv`)}}),w=!1,t.appendLine("[OK] Alle Server gestoppt"),s.window.showInformationMessage("Alle Server wurden gestoppt.")}function G(){t.appendLine("[INFO] ===== Server Status =====");try{p.execSync('powershell -NoProfile -Command "Get-Process llama-server -ErrorAction SilentlyContinue | Select-Object ProcessName, Id"',{encoding:"utf-8",windowsHide:!0})?t.appendLine("[OK] Llama-Server l\xE4uft"):t.appendLine("[STOP] Llama-Server nicht aktiv")}catch{t.appendLine("[STOP] Llama-Server nicht aktiv")}try{p.execSync(`powershell -NoProfile -Command "Get-Process python -ErrorAction SilentlyContinue | Where-Object { $_.CommandLine -like '*embedding*' } | Select-Object ProcessName, Id"`,{encoding:"utf-8",windowsHide:!0})?t.appendLine("[OK] Embedding-Server l\xE4uft"):t.appendLine("[STOP] Embedding-Server nicht aktiv")}catch{t.appendLine("[STOP] Embedding-Server nicht aktiv")}try{p.execSync(`powershell -NoProfile -Command "Get-Process python -ErrorAction SilentlyContinue | Where-Object { $_.CommandLine -like '*rag*' } | Select-Object ProcessName, Id"`,{encoding:"utf-8",windowsHide:!0})?t.appendLine("[OK] RAG-Server l\xE4uft"):t.appendLine("[STOP] RAG-Server nicht aktiv")}catch{t.appendLine("[STOP] RAG-Server nicht aktiv")}try{p.execSync('powershell -NoProfile -Command "Get-Process qdrant -ErrorAction SilentlyContinue | Select-Object ProcessName, Id"',{encoding:"utf-8",windowsHide:!0})?t.appendLine("[OK] Qdrant l\xE4uft"):t.appendLine("[STOP] Qdrant nicht aktiv")}catch{t.appendLine("[STOP] Qdrant nicht aktiv")}t.appendLine(""),t.appendLine("[INFO] --- Continue-verwaltete Server ---");try{p.execSync(`powershell -NoProfile -Command "Get-Process python -ErrorAction SilentlyContinue | Where-Object { $_.CommandLine -like '*mcp*' } | Select-Object ProcessName, Id"`,{encoding:"utf-8",windowsHide:!0})?t.appendLine("[OK] MCP-Server l\xE4uft (von Continue verwaltet)"):t.appendLine("[STOP] MCP-Server nicht aktiv (wird von Continue gestartet)")}catch{t.appendLine("[STOP] MCP-Server nicht aktiv (wird von Continue gestartet)")}s.window.showInformationMessage("Server Status angezeigt (siehe Output)")}function j(){t.appendLine("[INFO] ===== Extension wird deaktiviert ====="),d.forEach(e=>{e.dispose()}),d.length=0,C()}0&&(module.exports={activate,deactivate});
