"use strict";var y=Object.create;var S=Object.defineProperty;var E=Object.getOwnPropertyDescriptor;var b=Object.getOwnPropertyNames;var R=Object.getPrototypeOf,A=Object.prototype.hasOwnProperty;var T=(e,n)=>{for(var r in n)S(e,r,{get:n[r],enumerable:!0})},P=(e,n,r,s)=>{if(n&&typeof n=="object"||typeof n=="function")for(let i of b(n))!A.call(e,i)&&i!==r&&S(e,i,{get:()=>n[i],enumerable:!(s=E(n,i))||s.enumerable});return e};var h=(e,n,r)=>(r=e!=null?y(R(e)):{},P(n||!e||!e.__esModule?S(r,"default",{value:e,enumerable:!0}):r,e)),$=e=>P(S({},"__esModule",{value:!0}),e);var H={};T(H,{activate:()=>k,deactivate:()=>j});module.exports=$(H);var o=h(require("vscode")),p=h(require("child_process")),l=h(require("path")),a=h(require("fs"));var d=[],t,w=!1,v={embedding:"C:\\Users\\marku\\Documents\\GitHub\\artqcid\\ai-projects\\embedding-server-misc",rag:"C:\\Users\\marku\\Documents\\GitHub\\artqcid\\ai-projects\\rag-server-misc",llama:"C:\\Users\\marku\\.continue\\llama-vscode-autostart.ps1",mcp:"C:\\Users\\marku\\Documents\\GitHub\\artqcid\\ai-projects\\mcp-server-misc"},f={llama:8080,embedding:8001,rag:8002,mcp:8003};function m(){let e=o.workspace.getConfiguration("juce-server-autostart");return{embedding:e.get("embeddingServerPath",v.embedding),rag:e.get("ragServerPath",v.rag),llama:e.get("llamaScriptPath",v.llama),mcp:e.get("mcpServerPath",v.mcp)}}function k(e){t=o.window.createOutputChannel("JUCE Server Autostart"),e.subscriptions.push(t),t.appendLine("[INFO] ===== JUCE Server Autostart Extension aktiviert ====="),t.show(!0);let n=o.commands.registerCommand("serverAutostart.startServers",()=>{L()}),r=o.commands.registerCommand("serverAutostart.stopServers",()=>{O()}),s=o.commands.registerCommand("serverAutostart.showStatus",()=>{G()});e.subscriptions.push(n,r,s);let i=o.workspace.getConfiguration("juce-server-autostart").get("autoStartDelay",2e3);t.appendLine(`[INFO] Starte alle Server beim Extension-Startup (Verz\xF6gerung: ${i}ms)...`),setTimeout(()=>L(),i)}function L(){if(w){t.appendLine("[WARN] Server sind bereits gestartet"),o.window.showWarningMessage("Server sind bereits gestartet. Verwende Stop vor Start.");return}if(t.appendLine("[INFO] ===== Starte alle Server ====="),o.window.showInformationMessage("Starte AI-Server..."),!N()){o.window.showErrorMessage("Ein oder mehrere Server-Pfade sind nicht konfiguriert!");return}t.appendLine("[INFO] Startup-Sequenz: Llama \u2192 Embedding \u2192 RAG \u2192 MCP"),F(),setTimeout(()=>{x()},3e3),setTimeout(()=>{M()},8e3),setTimeout(()=>{I(),t.appendLine("[OK] ===== Alle Server gestartet ====="),o.window.showInformationMessage("Alle AI-Server wurden erfolgreich gestartet!")},12e3),w=!0}function N(){let e=m(),n=!0;return a.existsSync(e.llama)||(t.appendLine(`[ERROR] Llama Script nicht gefunden: ${e.llama}`),n=!1),a.existsSync(e.embedding)||(t.appendLine(`[ERROR] Embedding-Server Pfad nicht gefunden: ${e.embedding}`),n=!1),a.existsSync(e.rag)||(t.appendLine(`[ERROR] RAG-Server Pfad nicht gefunden: ${e.rag}`),n=!1),a.existsSync(e.mcp)||(t.appendLine(`[ERROR] MCP-Server Pfad nicht gefunden: ${e.mcp}`),n=!1),n}function F(){let e=m();t.appendLine("[INFO] Starte Llama-Server auf Port 8080...");let n=o.window.createTerminal({name:"Llama Server",hideFromUser:!1});d.push(n),n.show();let r=`powershell -NoProfile -ExecutionPolicy Bypass -File "${e.llama}"`;t.appendLine(`[CMD] ${r}`),n.sendText(r,!0),setTimeout(()=>{g("Llama",f.llama)},5e3)}async function g(e,n,r=10){return new Promise(s=>{let i=0,u=()=>{let C=require("net"),c=new C.Socket;c.setTimeout(1e3),c.once("connect",()=>{c.destroy(),t.appendLine(`[OK] ${e} ist verf\xFCgbar (Port ${n})`),s(!0)}),c.once("timeout",()=>{c.destroy(),i++,i<r?setTimeout(u,1e3):(t.appendLine(`[WARN] ${e} hat nicht geantwortet nach ${r*1e3}ms`),s(!1))}),c.once("error",()=>{c.destroy(),i++,i<r?setTimeout(u,1e3):(t.appendLine(`[WARN] ${e} konnte nicht erreicht werden (Port ${n})`),s(!1))}),c.connect({port:n,host:"127.0.0.1"})};u()})}function x(){let e=m();t.appendLine(`[INFO] Starte Embedding-Server auf Port 8001: ${e.embedding}`);let n=l.join(e.embedding,"start.ps1");if(!a.existsSync(n)){t.appendLine(`[ERROR] start.ps1 nicht gefunden: ${n}`),o.window.showErrorMessage("Embedding Server start.ps1 nicht gefunden");return}let r=o.window.createTerminal({name:"Embedding Server",hideFromUser:!1});d.push(r),r.show();let s=`pwsh -NoProfile -ExecutionPolicy Bypass -File "${n}"`;t.appendLine(`[CMD] ${s}`),r.sendText(s,!0),setTimeout(()=>{g("Embedding",f.embedding)},3e3)}function M(){let e=m();t.appendLine(`[INFO] Starte RAG-Server auf Port 8002: ${e.rag}`);let n=l.join(e.rag,"start.ps1");if(!a.existsSync(n)){t.appendLine(`[ERROR] start.ps1 nicht gefunden: ${n}`),o.window.showErrorMessage("RAG Server start.ps1 nicht gefunden");return}let r=o.window.createTerminal({name:"RAG Server",hideFromUser:!1});d.push(r),r.show();let s=`pwsh -NoProfile -ExecutionPolicy Bypass -File "${n}"`;t.appendLine(`[CMD] ${s}`),r.sendText(s,!0),setTimeout(()=>{g("RAG",f.rag)},5e3)}function I(){let e=m();t.appendLine(`[INFO] Starte MCP-Server (SSE) auf Port 8003: ${e.mcp}`);let n=l.join(e.mcp,"start-sse.ps1");if(!a.existsSync(n)){t.appendLine(`[ERROR] start-sse.ps1 nicht gefunden: ${n}`),o.window.showErrorMessage("MCP Server start-sse.ps1 nicht gefunden");return}let r=o.window.createTerminal({name:"MCP Server",hideFromUser:!1});d.push(r),r.show();let s=`pwsh -NoProfile -ExecutionPolicy Bypass -File "${n}"`;t.appendLine(`[CMD] ${s}`),r.sendText(s,!0),setTimeout(()=>{g("MCP",f.mcp)},3e3)}function O(){t.appendLine("[INFO] ===== Stoppe alle Server ====="),o.window.showInformationMessage("Stoppe alle Server..."),d.forEach(s=>{t.appendLine(`[INFO] Schlie\xDFe Terminal: ${s.name}`),s.dispose()}),d.length=0;let e=m(),n=l.join(e.mcp,"stop.ps1");if(a.existsSync(n))try{p.execSync(`powershell -NoProfile -ExecutionPolicy Bypass -File "${n}"`,{windowsHide:!0}),t.appendLine("[OK] MCP Server gestoppt")}catch{t.appendLine("[INFO] MCP Server nicht aktiv")}[{name:"RAG Server + Qdrant",cmd:"Get-Process python -ErrorAction SilentlyContinue | Where-Object { $_.CommandLine -like '*rag*' } | Stop-Process -Force; Get-Process qdrant -ErrorAction SilentlyContinue | Stop-Process -Force"},{name:"Embedding Server",cmd:"Get-Process python -ErrorAction SilentlyContinue | Where-Object { $_.CommandLine -like '*embedding_server*' } | Stop-Process -Force"},{name:"Llama-Server",cmd:"Get-Process llama-server -ErrorAction SilentlyContinue | Stop-Process -Force"}].forEach(({name:s,cmd:i})=>{try{p.execSync(`powershell -NoProfile -Command "${i}"`,{windowsHide:!0}),t.appendLine(`[OK] ${s} gestoppt`)}catch{t.appendLine(`[INFO] ${s} nicht aktiv`)}}),w=!1,t.appendLine("[OK] Alle Server gestoppt"),o.window.showInformationMessage("Alle Server wurden gestoppt.")}function G(){t.appendLine("[INFO] ===== Server Status =====");try{p.execSync('powershell -NoProfile -Command "Get-Process llama-server -ErrorAction SilentlyContinue | Select-Object ProcessName, Id"',{encoding:"utf-8",windowsHide:!0})?t.appendLine("[OK] Llama-Server l\xE4uft"):t.appendLine("[STOP] Llama-Server nicht aktiv")}catch{t.appendLine("[STOP] Llama-Server nicht aktiv")}try{p.execSync(`powershell -NoProfile -Command "Get-Process python -ErrorAction SilentlyContinue | Where-Object { $_.CommandLine -like '*embedding*' } | Select-Object ProcessName, Id"`,{encoding:"utf-8",windowsHide:!0})?t.appendLine("[OK] Embedding-Server l\xE4uft"):t.appendLine("[STOP] Embedding-Server nicht aktiv")}catch{t.appendLine("[STOP] Embedding-Server nicht aktiv")}try{p.execSync(`powershell -NoProfile -Command "Get-Process python -ErrorAction SilentlyContinue | Where-Object { $_.CommandLine -like '*rag*' } | Select-Object ProcessName, Id"`,{encoding:"utf-8",windowsHide:!0})?t.appendLine("[OK] RAG-Server l\xE4uft"):t.appendLine("[STOP] RAG-Server nicht aktiv")}catch{t.appendLine("[STOP] RAG-Server nicht aktiv")}try{p.execSync('powershell -NoProfile -Command "Get-Process qdrant -ErrorAction SilentlyContinue | Select-Object ProcessName, Id"',{encoding:"utf-8",windowsHide:!0})?t.appendLine("[OK] Qdrant l\xE4uft"):t.appendLine("[STOP] Qdrant nicht aktiv")}catch{t.appendLine("[STOP] Qdrant nicht aktiv")}t.appendLine(""),t.appendLine("[INFO] --- MCP Server (SSE) ---");let e=require("net"),n=new e.Socket;n.setTimeout(1e3),n.once("connect",()=>{n.destroy(),t.appendLine("[OK] MCP-Server l\xE4uft (Port 8003)")}),n.once("timeout",()=>{n.destroy(),t.appendLine("[STOP] MCP-Server nicht aktiv (Port 8003)")}),n.once("error",()=>{n.destroy(),t.appendLine("[STOP] MCP-Server nicht aktiv (Port 8003)")}),n.connect({port:8003,host:"127.0.0.1"}),o.window.showInformationMessage("Server Status angezeigt (siehe Output)")}function j(){t.appendLine("[INFO] ===== Extension wird deaktiviert ====="),d.forEach(e=>{e.dispose()}),d.length=0,O()}0&&(module.exports={activate,deactivate});
