"use strict";var g=Object.create;var l=Object.defineProperty;var h=Object.getOwnPropertyDescriptor;var f=Object.getOwnPropertyNames;var v=Object.getPrototypeOf,S=Object.prototype.hasOwnProperty;var L=(e,t)=>{for(var o in t)l(e,o,{get:t[o],enumerable:!0})},u=(e,t,o,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of f(t))!S.call(e,a)&&a!==o&&l(e,a,{get:()=>t[a],enumerable:!(n=h(t,a))||n.enumerable});return e};var m=(e,t,o)=>(o=e!=null?g(v(e)):{},u(t||!e||!e.__esModule?l(o,"default",{value:e,enumerable:!0}):o,e)),P=e=>u(l({},"__esModule",{value:!0}),e);var E={};L(E,{activate:()=>$,deactivate:()=>b});module.exports=P(E);var s=m(require("vscode")),i=m(require("child_process"));var c=m(require("fs")),p=[],d=[],r;function $(e){r=s.window.createOutputChannel("Llama Autostart"),e.subscriptions.push(r),r.appendLine("=== Llama Autostart Extension aktiviert ==="),r.show(!0),s.window.showInformationMessage("Llama Autostart Extension wurde aktiviert!");let t=s.commands.registerCommand("llamaAutostart.startServers",()=>{w()}),o=s.commands.registerCommand("llamaAutostart.stopServers",()=>{y()});e.subscriptions.push(t,o),w()}function w(){r.appendLine("=== startServers() aufgerufen ===");let e=s.workspace.getConfiguration("llamaAutostart"),t=e.get("autostartScriptPath"),o=e.get("useIntegratedTerminal",!0);r.appendLine("Konfiguration gelesen:"),r.appendLine(`  scriptPath: ${t}`),r.appendLine(`  useIntegratedTerminal: ${o}`),t?M(t,o):s.window.showWarningMessage("Llama Autostart: Kein Pfad zum Llama-Startscript konfiguriert."),C(o)}function y(){s.window.showInformationMessage("Llama Autostart: Stoppe Server..."),d.forEach(e=>{e.dispose()}),d.length=0;try{i.execSync('powershell -NoProfile -Command "Get-Process llama-server -ErrorAction SilentlyContinue | Stop-Process -Force"',{windowsHide:!0}),s.window.showInformationMessage("llama-server gestoppt")}catch{console.log("Kein llama-server-Prozess gefunden oder Fehler beim Stoppen")}p.forEach(e=>{try{process.kill(e.pid,"SIGTERM"),console.log(`${e.name} (PID: ${e.pid}) gestoppt`)}catch(t){console.log(`Fehler beim Stoppen von ${e.name} (PID: ${e.pid}):`,t)}}),p.length=0;try{i.execSync(`powershell -NoProfile -Command "Get-Process python -ErrorAction SilentlyContinue | Where-Object { $_.CommandLine -like '*web_mcp.py*' } | Stop-Process -Force"`,{windowsHide:!0})}catch{console.log("Keine MCP Python-Prozesse gefunden")}}function M(e,t){if(r.appendLine("=== startLlamaServer() aufgerufen ==="),r.appendLine(`  scriptPath: ${e}`),r.appendLine(`  useIntegratedTerminal: ${t}`),!c.existsSync(e)){r.appendLine("  FEHLER: Startscript nicht gefunden!"),s.window.showErrorMessage(`Llama Autostart: Startscript nicht gefunden: ${e}`);return}if(r.appendLine("  Script existiert, starte Server..."),s.window.showInformationMessage("Llama Autostart: Starte Llama-Server..."),t){let o=s.window.createTerminal({name:"Llama Server",hideFromUser:!1});d.push(o),r.appendLine('  Terminal erstellt: "Llama Server"'),r.appendLine(`  Starte Befehl: powershell -NoProfile -ExecutionPolicy Bypass -File "${e}"`),o.show(),o.sendText(`powershell -NoProfile -ExecutionPolicy Bypass -File "${e}"`,!0),r.appendLine("  Befehl gesendet!"),setTimeout(()=>{s.window.showInformationMessage("Llama Autostart: Llama-Server wurde gestartet (siehe Terminal).")},2e3)}else{let o=i.spawn("powershell",["-NoProfile","-ExecutionPolicy","Bypass","-File",e],{detached:!0,stdio:"ignore",windowsHide:!1});o.unref(),o.on("error",n=>{s.window.showErrorMessage("Llama Autostart: Fehler beim Starten des Scripts: "+n.message)}),setTimeout(()=>{s.window.showInformationMessage("Llama Autostart: Llama-Server wurde gestartet.")},2e3)}}function C(e){r.appendLine("=== startWebMcp() aufgerufen ===");let t="C:\\mcp\\.venv\\Scripts\\python.exe",o="C:\\mcp\\web_mcp.py";if(!c.existsSync(t)){r.appendLine(`  FEHLER: Python nicht gefunden: ${t}`),s.window.showErrorMessage(`Llama Autostart: Python nicht gefunden: ${t}`);return}if(!c.existsSync(o)){r.appendLine(`  FEHLER: web_mcp.py nicht gefunden: ${o}`),s.window.showErrorMessage(`Llama Autostart: web_mcp.py nicht gefunden: ${o}`);return}if(r.appendLine(`  Python: ${t}`),r.appendLine(`  Script: ${o}`),s.window.showInformationMessage("Llama Autostart: Starte Web MCP Server..."),e){let n=s.window.createTerminal({name:"MCP: web-context",hideFromUser:!1});d.push(n),r.appendLine('  Terminal erstellt: "MCP: web-context"'),r.appendLine(`  Starte Befehl: "${t}" "${o}"`),n.show(),n.sendText(`& "${t}" "${o}"`,!0),r.appendLine("  Befehl gesendet!"),setTimeout(()=>{s.window.showInformationMessage("Llama Autostart: Web MCP Server wurde gestartet (siehe Terminal).")},2e3)}else{let n=i.spawn(t,[o],{detached:!0,stdio:"ignore"});n.unref(),n.pid&&(p.push({name:"web-mcp",pid:n.pid}),r.appendLine(`  Web MCP Server gestartet (PID: ${n.pid})`)),n.on("error",a=>{r.appendLine(`  FEHLER beim Starten: ${a.message}`),s.window.showErrorMessage(`Llama Autostart: Web MCP Server Fehler: ${a.message}`)}),setTimeout(()=>{s.window.showInformationMessage("Llama Autostart: Web MCP Server wurde gestartet.")},2e3)}}function b(){console.log("Llama Autostart Extension wird deaktiviert - stoppe Server..."),d.forEach(e=>{e.dispose()});try{i.execSync('powershell -NoProfile -Command "Get-Process llama-server -ErrorAction SilentlyContinue | Stop-Process -Force"',{windowsHide:!0}),console.log("llama-server gestoppt")}catch{console.log("Kein llama-server-Prozess gefunden oder Fehler beim Stoppen")}p.forEach(e=>{try{process.kill(e.pid,"SIGTERM"),console.log(`${e.name} (PID: ${e.pid}) gestoppt`)}catch(t){console.log(`Fehler beim Stoppen von ${e.name} (PID: ${e.pid}):`,t)}});try{i.execSync(`powershell -NoProfile -Command "Get-Process python -ErrorAction SilentlyContinue | Where-Object { $_.CommandLine -like '*web_mcp.py*' } | Stop-Process -Force"`,{windowsHide:!0}),console.log("MCP Python-Prozesse gestoppt")}catch{console.log("Keine MCP Python-Prozesse gefunden oder Fehler beim Stoppen")}}0&&(module.exports={activate,deactivate});
