"use strict";var w=Object.create;var p=Object.defineProperty;var P=Object.getOwnPropertyDescriptor;var C=Object.getOwnPropertyNames;var L=Object.getPrototypeOf,E=Object.prototype.hasOwnProperty;var b=(e,t)=>{for(var n in t)p(e,n,{get:t[n],enumerable:!0})},h=(e,t,n,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of C(t))!E.call(e,a)&&a!==n&&p(e,a,{get:()=>t[a],enumerable:!(o=P(t,a))||o.enumerable});return e};var m=(e,t,n)=>(n=e!=null?w(L(e)):{},h(t||!e||!e.__esModule?p(n,"default",{value:e,enumerable:!0}):n,e)),O=e=>h(p({},"__esModule",{value:!0}),e);var I={};b(I,{activate:()=>y,deactivate:()=>k});module.exports=O(I);var s=m(require("vscode")),d=m(require("child_process")),v=m(require("path")),c=m(require("fs"));var i=[],r,S=!1,u={mcp:"C:\\Users\\marku\\Documents\\GitHub\\artqcid\\ai-projects\\mcp-server-misc",embedding:"C:\\Users\\marku\\Documents\\GitHub\\artqcid\\ai-projects\\embedding-server-misc",llama:"C:\\Users\\marku\\.continue\\llama-vscode-autostart.ps1"};function l(){let e=s.workspace.getConfiguration("juce-server-autostart");return{mcp:e.get("mcpServerPath",u.mcp),embedding:e.get("embeddingServerPath",u.embedding),llama:e.get("llamaScriptPath",u.llama)}}function y(e){r=s.window.createOutputChannel("JUCE Server Autostart"),e.subscriptions.push(r),r.appendLine("[INFO] ===== JUCE Server Autostart Extension aktiviert ====="),r.show(!0);let t=s.commands.registerCommand("serverAutostart.startServers",()=>{f()}),n=s.commands.registerCommand("serverAutostart.stopServers",()=>{g()}),o=s.commands.registerCommand("serverAutostart.showStatus",()=>{M()});e.subscriptions.push(t,n,o);let a=s.workspace.getConfiguration("juce-server-autostart").get("autoStartDelay",2e3);r.appendLine(`[INFO] Starte alle Server beim Extension-Startup (Verz\xF6gerung: ${a}ms)...`),setTimeout(()=>f(),a)}function f(){if(S){r.appendLine("[WARN] Server sind bereits gestartet"),s.window.showWarningMessage("Server sind bereits gestartet. Verwende Stop vor Start.");return}if(r.appendLine("[INFO] ===== Starte alle Server ====="),s.window.showInformationMessage("Starte AI-Server..."),!N()){s.window.showErrorMessage("Ein oder mehrere Server-Pfade sind nicht konfiguriert!");return}$(),setTimeout(()=>{x()},2e3),setTimeout(()=>{F()},5e3),S=!0}function N(){let e=l(),t=!0;return c.existsSync(e.llama)||(r.appendLine(`[ERROR] Llama Script nicht gefunden: ${e.llama}`),t=!1),c.existsSync(e.embedding)||(r.appendLine(`[ERROR] Embedding-Server Pfad nicht gefunden: ${e.embedding}`),t=!1),c.existsSync(e.mcp)||(r.appendLine(`[ERROR] MCP-Server Pfad nicht gefunden: ${e.mcp}`),t=!1),t}function $(){let e=l();r.appendLine("[INFO] Starte Llama-Server...");let t=s.window.createTerminal({name:"Llama Server",hideFromUser:!1});i.push(t),t.show();let n=`powershell -NoProfile -ExecutionPolicy Bypass -File "${e.llama}"`;r.appendLine(`[CMD] ${n}`),t.sendText(n,!0)}function x(){let e=l();r.appendLine(`[INFO] Starte Embedding-Server: ${e.embedding}`);let t=v.join(e.embedding,"start.ps1");if(!c.existsSync(t)){r.appendLine(`[ERROR] start.ps1 nicht gefunden: ${t}`),s.window.showErrorMessage("Embedding Server start.ps1 nicht gefunden");return}let n=s.window.createTerminal({name:"Embedding Server",hideFromUser:!1});i.push(n),n.show();let o=`pwsh -NoProfile -ExecutionPolicy Bypass -File "${t}"`;r.appendLine(`[CMD] ${o}`),n.sendText(o,!0)}function F(){let e=l();r.appendLine(`[INFO] Starte MCP-Server: ${e.mcp}`);let t=v.join(e.mcp,"start.ps1");if(!c.existsSync(t)){r.appendLine(`[ERROR] start.ps1 nicht gefunden: ${t}`),s.window.showErrorMessage("MCP Server start.ps1 nicht gefunden");return}let n=s.window.createTerminal({name:"MCP Server",hideFromUser:!1});i.push(n),n.show();let o=`pwsh -NoProfile -ExecutionPolicy Bypass -File "${t}"`;r.appendLine(`[CMD] ${o}`),n.sendText(o,!0)}function g(){r.appendLine("[INFO] ===== Stoppe alle Server ====="),s.window.showInformationMessage("Stoppe alle Server..."),i.forEach(t=>{r.appendLine(`[INFO] Schlie\xDFe Terminal: ${t.name}`),t.dispose()}),i.length=0,[{name:"Llama-Server",cmd:"Get-Process llama-server -ErrorAction SilentlyContinue | Stop-Process -Force"},{name:"Embedding Server",cmd:"Get-Process python -ErrorAction SilentlyContinue | Where-Object { $_.CommandLine -like '*embedding_server*' } | Stop-Process -Force"},{name:"MCP Server",cmd:"Get-Process python -ErrorAction SilentlyContinue | Where-Object { $_.CommandLine -like '*mcp_server*' } | Stop-Process -Force"}].forEach(({name:t,cmd:n})=>{try{d.execSync(`powershell -NoProfile -Command "${n}"`,{windowsHide:!0}),r.appendLine(`[OK] ${t} gestoppt`)}catch{r.appendLine(`[INFO] ${t} nicht aktiv`)}}),S=!1,r.appendLine("[OK] Alle Server gestoppt"),s.window.showInformationMessage("Alle Server wurden gestoppt.")}function M(){r.appendLine("[INFO] ===== Server Status =====");try{d.execSync('powershell -NoProfile -Command "Get-Process llama-server -ErrorAction SilentlyContinue | Select-Object ProcessName, Id"',{encoding:"utf-8",windowsHide:!0})?r.appendLine("[OK] Llama-Server l\xE4uft"):r.appendLine("[STOP] Llama-Server nicht aktiv")}catch{r.appendLine("[STOP] Llama-Server nicht aktiv")}try{d.execSync(`powershell -NoProfile -Command "Get-Process python -ErrorAction SilentlyContinue | Where-Object { $_.CommandLine -like '*embedding*' } | Select-Object ProcessName, Id"`,{encoding:"utf-8",windowsHide:!0})?r.appendLine("[OK] Embedding-Server l\xE4uft"):r.appendLine("[STOP] Embedding-Server nicht aktiv")}catch{r.appendLine("[STOP] Embedding-Server nicht aktiv")}try{d.execSync(`powershell -NoProfile -Command "Get-Process python -ErrorAction SilentlyContinue | Where-Object { $_.CommandLine -like '*mcp*' } | Select-Object ProcessName, Id"`,{encoding:"utf-8",windowsHide:!0})?r.appendLine("[OK] MCP-Server l\xE4uft"):r.appendLine("[STOP] MCP-Server nicht aktiv")}catch{r.appendLine("[STOP] MCP-Server nicht aktiv")}s.window.showInformationMessage("Server Status angezeigt (siehe Output)")}function k(){r.appendLine("[INFO] ===== Extension wird deaktiviert ====="),i.forEach(e=>{e.dispose()}),i.length=0,g()}0&&(module.exports={activate,deactivate});
