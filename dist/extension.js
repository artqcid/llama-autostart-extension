"use strict";var b=Object.create;var l=Object.defineProperty;var E=Object.getOwnPropertyDescriptor;var y=Object.getOwnPropertyNames;var A=Object.getPrototypeOf,R=Object.prototype.hasOwnProperty;var k=(e,n)=>{for(var r in n)l(e,r,{get:n[r],enumerable:!0})},P=(e,n,r,o)=>{if(n&&typeof n=="object"||typeof n=="function")for(let i of y(n))!R.call(e,i)&&i!==r&&l(e,i,{get:()=>n[i],enumerable:!(o=E(n,i))||o.enumerable});return e};var m=(e,n,r)=>(r=e!=null?b(A(e)):{},P(n||!e||!e.__esModule?l(r,"default",{value:e,enumerable:!0}):r,e)),N=e=>P(l({},"__esModule",{value:!0}),e);var M={};k(M,{activate:()=>T,deactivate:()=>j});module.exports=N(M);var s=m(require("vscode")),c=m(require("child_process")),g=m(require("path")),p=m(require("fs"));var d=[],t,h=!1,v={embedding:"C:\\Users\\marku\\Documents\\GitHub\\artqcid\\ai-projects\\embedding-server-misc",rag:"C:\\Users\\marku\\Documents\\GitHub\\artqcid\\ai-projects\\rag-server-misc",llama:"C:\\Users\\marku\\.continue\\llama-vscode-autostart.ps1"},f={llama:8080,embedding:8001,rag:8002};function u(){let e=s.workspace.getConfiguration("juce-server-autostart");return{embedding:e.get("embeddingServerPath",v.embedding),rag:e.get("ragServerPath",v.rag),llama:e.get("llamaScriptPath",v.llama)}}function T(e){t=s.window.createOutputChannel("JUCE Server Autostart"),e.subscriptions.push(t),t.appendLine("[INFO] ===== JUCE Server Autostart Extension aktiviert ====="),t.show(!0);let n=s.commands.registerCommand("serverAutostart.startServers",()=>{L()}),r=s.commands.registerCommand("serverAutostart.stopServers",()=>{O()}),o=s.commands.registerCommand("serverAutostart.showStatus",()=>{G()});e.subscriptions.push(n,r,o);let i=s.workspace.getConfiguration("juce-server-autostart").get("autoStartDelay",2e3);t.appendLine(`[INFO] Starte alle Server beim Extension-Startup (Verz\xF6gerung: ${i}ms)...`),setTimeout(()=>L(),i)}function L(){if(h){t.appendLine("[WARN] Server sind bereits gestartet"),s.window.showWarningMessage("Server sind bereits gestartet. Verwende Stop vor Start.");return}if(t.appendLine("[INFO] ===== Starte alle Server ====="),s.window.showInformationMessage("Starte AI-Server..."),!$()){s.window.showErrorMessage("Ein oder mehrere Server-Pfade sind nicht konfiguriert!");return}t.appendLine("[INFO] Startup-Sequenz: Llama \u2192 Embedding \u2192 RAG"),t.appendLine("[INFO] (MCP wird von Continue verwaltet)"),I(),setTimeout(()=>{F()},3e3),setTimeout(()=>{x(),t.appendLine("[OK] ===== Alle Server gestartet ====="),s.window.showInformationMessage("Alle AI-Server wurden erfolgreich gestartet!")},8e3),h=!0}function $(){let e=u(),n=!0;return p.existsSync(e.llama)||(t.appendLine(`[ERROR] Llama Script nicht gefunden: ${e.llama}`),n=!1),p.existsSync(e.embedding)||(t.appendLine(`[ERROR] Embedding-Server Pfad nicht gefunden: ${e.embedding}`),n=!1),p.existsSync(e.rag)||(t.appendLine(`[ERROR] RAG-Server Pfad nicht gefunden: ${e.rag}`),n=!1),n}function I(){let e=u();t.appendLine("[INFO] Starte Llama-Server auf Port 8080...");let n=s.window.createTerminal({name:"Llama Server",hideFromUser:!1});d.push(n),n.show();let r=`powershell -NoProfile -ExecutionPolicy Bypass -File "${e.llama}"`;t.appendLine(`[CMD] ${r}`),n.sendText(r,!0),setTimeout(()=>{w("Llama",f.llama)},5e3)}async function w(e,n,r=10){return new Promise(o=>{let i=0,S=()=>{let C=require("net"),a=new C.Socket;a.setTimeout(1e3),a.once("connect",()=>{a.destroy(),t.appendLine(`[OK] ${e} ist verf\xFCgbar (Port ${n})`),o(!0)}),a.once("timeout",()=>{a.destroy(),i++,i<r?setTimeout(S,1e3):(t.appendLine(`[WARN] ${e} hat nicht geantwortet nach ${r*1e3}ms`),o(!1))}),a.once("error",()=>{a.destroy(),i++,i<r?setTimeout(S,1e3):(t.appendLine(`[WARN] ${e} konnte nicht erreicht werden (Port ${n})`),o(!1))}),a.connect({port:n,host:"127.0.0.1"})};S()})}function F(){let e=u();t.appendLine(`[INFO] Starte Embedding-Server auf Port 8001: ${e.embedding}`);let n=g.join(e.embedding,"start.ps1");if(!p.existsSync(n)){t.appendLine(`[ERROR] start.ps1 nicht gefunden: ${n}`),s.window.showErrorMessage("Embedding Server start.ps1 nicht gefunden");return}let r=s.window.createTerminal({name:"Embedding Server",hideFromUser:!1});d.push(r),r.show();let o=`pwsh -NoProfile -ExecutionPolicy Bypass -File "${n}"`;t.appendLine(`[CMD] ${o}`),r.sendText(o,!0),setTimeout(()=>{w("Embedding",f.embedding)},3e3)}function x(){let e=u();t.appendLine(`[INFO] Starte RAG-Server auf Port 8002: ${e.rag}`);let n=g.join(e.rag,"start.ps1");if(!p.existsSync(n)){t.appendLine(`[ERROR] start.ps1 nicht gefunden: ${n}`),s.window.showErrorMessage("RAG Server start.ps1 nicht gefunden");return}let r=s.window.createTerminal({name:"RAG Server",hideFromUser:!1});d.push(r),r.show();let o=`pwsh -NoProfile -ExecutionPolicy Bypass -File "${n}"`;t.appendLine(`[CMD] ${o}`),r.sendText(o,!0),setTimeout(()=>{w("RAG",f.rag)},5e3)}function O(){t.appendLine("[INFO] ===== Stoppe alle Server ====="),s.window.showInformationMessage("Stoppe alle Server..."),d.forEach(n=>{t.appendLine(`[INFO] Schlie\xDFe Terminal: ${n.name}`),n.dispose()}),d.length=0,[{name:"RAG Server + Qdrant",cmd:"Get-Process python -ErrorAction SilentlyContinue | Where-Object { $_.CommandLine -like '*rag*' } | Stop-Process -Force; Get-Process qdrant -ErrorAction SilentlyContinue | Stop-Process -Force"},{name:"Embedding Server",cmd:"Get-Process python -ErrorAction SilentlyContinue | Where-Object { $_.CommandLine -like '*embedding_server*' } | Stop-Process -Force"},{name:"Llama-Server",cmd:"Get-Process llama-server -ErrorAction SilentlyContinue | Stop-Process -Force"}].forEach(({name:n,cmd:r})=>{try{c.execSync(`powershell -NoProfile -Command "${r}"`,{windowsHide:!0}),t.appendLine(`[OK] ${n} gestoppt`)}catch{t.appendLine(`[INFO] ${n} nicht aktiv`)}}),h=!1,t.appendLine("[OK] Alle Server gestoppt"),s.window.showInformationMessage("Alle Server wurden gestoppt.")}function G(){t.appendLine("[INFO] ===== Server Status =====");try{c.execSync('powershell -NoProfile -Command "Get-Process llama-server -ErrorAction SilentlyContinue | Select-Object ProcessName, Id"',{encoding:"utf-8",windowsHide:!0})?t.appendLine("[OK] Llama-Server l\xE4uft"):t.appendLine("[STOP] Llama-Server nicht aktiv")}catch{t.appendLine("[STOP] Llama-Server nicht aktiv")}try{c.execSync(`powershell -NoProfile -Command "Get-Process python -ErrorAction SilentlyContinue | Where-Object { $_.CommandLine -like '*embedding*' } | Select-Object ProcessName, Id"`,{encoding:"utf-8",windowsHide:!0})?t.appendLine("[OK] Embedding-Server l\xE4uft"):t.appendLine("[STOP] Embedding-Server nicht aktiv")}catch{t.appendLine("[STOP] Embedding-Server nicht aktiv")}try{c.execSync(`powershell -NoProfile -Command "Get-Process python -ErrorAction SilentlyContinue | Where-Object { $_.CommandLine -like '*rag*' } | Select-Object ProcessName, Id"`,{encoding:"utf-8",windowsHide:!0})?t.appendLine("[OK] RAG-Server l\xE4uft"):t.appendLine("[STOP] RAG-Server nicht aktiv")}catch{t.appendLine("[STOP] RAG-Server nicht aktiv")}try{c.execSync('powershell -NoProfile -Command "Get-Process qdrant -ErrorAction SilentlyContinue | Select-Object ProcessName, Id"',{encoding:"utf-8",windowsHide:!0})?t.appendLine("[OK] Qdrant l\xE4uft"):t.appendLine("[STOP] Qdrant nicht aktiv")}catch{t.appendLine("[STOP] Qdrant nicht aktiv")}t.appendLine(""),t.appendLine("[INFO] --- Continue-verwaltete Server ---");try{c.execSync(`powershell -NoProfile -Command "Get-Process python -ErrorAction SilentlyContinue | Where-Object { $_.CommandLine -like '*mcp*' } | Select-Object ProcessName, Id"`,{encoding:"utf-8",windowsHide:!0})?t.appendLine("[OK] MCP-Server l\xE4uft (von Continue verwaltet)"):t.appendLine("[STOP] MCP-Server nicht aktiv (wird von Continue gestartet)")}catch{t.appendLine("[STOP] MCP-Server nicht aktiv (wird von Continue gestartet)")}s.window.showInformationMessage("Server Status angezeigt (siehe Output)")}function j(){t.appendLine("[INFO] ===== Extension wird deaktiviert ====="),d.forEach(e=>{e.dispose()}),d.length=0,O()}0&&(module.exports={activate,deactivate});
